// Copyright lowRISC contributors (OpenTitan project).
// Licensed under the Apache License, Version 2.0, see LICENSE for details.
// SPDX-License-Identifier: Apache-2.0

#include <stdint.h>

#include "sw/device/coverage/compress.h"
#include "sw/device/coverage/printer.h"

// File magic: \x81OTCover
static const uint64_t magic = 0x7265766f43544f81;

// symbols generated by linker.
extern char __llvm_prf_cnts_start[];
extern char __llvm_prf_cnts_end[];
extern const uint64_t __llvm_profile_raw_version;

void coverage_printer_contents(void) {
  coverage_compress(&magic, sizeof(magic));
  coverage_compress(&__llvm_profile_raw_version, sizeof(__llvm_profile_raw_version));

  size_t cnts_size =
      (size_t)__llvm_prf_cnts_end - (size_t)__llvm_prf_cnts_start;
  uint8_t *cnts = (uint8_t *)__llvm_prf_cnts_start;
  coverage_compress(cnts, cnts_size);
}

void coverage_printer_init(void) { coverage_printer_init_cnts(); }

/**
 * We use the linker generated symbols directly, so these runtime initializers
 * are no-op.
 */
void __llvm_profile_register_names_function(void) {}
void __llvm_profile_register_function(void) {}
